<template>
  <div class="sample-app">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at ultrices odio, quis venenatis ex. Duis augue
      magna, aliquet et vehicula ut, consequat eu eros. Fusce consequat odio ac tincidunt pharetra. Proin molestie
      bibendum diam. Integer non turpis sagittis, venenatis metus eu, lacinia magna. Etiam erat dui, dictum ut velit id,
      porttitor volutpat eros. Integer eu neque pharetra, suscipit lacus eu, varius erat. Aliquam porttitor tempus nisi
      sit amet hendrerit. Proin sodales convallis dignissim. Quisque et mauris lorem. Phasellus maximus aliquam diam, ac
      malesuada elit consectetur ut. Pellentesque nec odio convallis massa elementum faucibus. Vestibulum egestas libero
      orci, sit amet bibendum eros placerat ac. Nam non luctus felis. Vivamus ut tincidunt urna.

      Proin faucibus dolor nunc, at interdum nisi lobortis vitae. Suspendisse a augue tellus. Nulla sit amet felis
      blandit, viverra justo ut, sodales leo. Curabitur in tristique augue. Aenean neque lacus, tempor facilisis dolor ac,
      aliquam volutpat nunc. Mauris placerat eros non velit bibendum malesuada. Nullam mollis dolor risus, eget tempor
      metus pretium euismod. Vivamus commodo ante at vehicula scelerisque. Integer semper ultricies rutrum. Nam ac
      hendrerit quam. In pulvinar, sapien vel lobortis efficitur, orci magna rutrum quam, eget dictum neque sapien eu
      dolor. Sed et augue eu mi dictum porta. Aenean tempor sodales neque, venenatis malesuada tortor malesuada ac.

      Sed felis nulla, mattis interdum turpis fringilla, posuere ultricies dolor. Pellentesque rutrum vitae quam vitae
      ornare. Quisque dapibus mi vitae dignissim mattis. Suspendisse eu risus convallis, tempor dui non, pretium dolor.
      Vestibulum at bibendum ex. Nulla sit amet diam in diam accumsan sodales. Sed aliquet quis urna et volutpat. Nullam
      sit amet placerat leo, vel interdum elit. Suspendisse at porttitor ipsum. Duis accumsan a massa sed vulputate.
      Vestibulum euismod nunc in tortor iaculis bibendum.

      Sed efficitur nisi nulla, sed blandit velit accumsan a. Phasellus tempus et elit at vehicula. Aenean efficitur
      tempor nulla at imperdiet. Aliquam in libero dignissim, maximus dui ac, aliquam felis. Proin leo sapien, efficitur
      non lacus ut, blandit auctor lacus. Morbi vel pellentesque ex, ac mattis augue. Suspendisse dignissim mauris mauris,
      vel scelerisque nibh volutpat sit amet. Suspendisse risus velit, volutpat quis viverra ut, ultricies vel lectus.
      Quisque lacinia metus ut convallis tincidunt. Donec lobortis felis libero, nec rutrum neque accumsan eget. Phasellus
      velit nunc, rhoncus sit amet libero et, bibendum tempor lectus. In congue magna vel dui vulputate, quis accumsan
      tortor egestas. Vestibulum egestas dignissim tellus, fermentum vulputate dui varius vitae. Nullam suscipit augue vel
      augue mattis, sit amet dictum ante blandit. Donec fringilla dapibus aliquet. Nunc eget erat at augue laoreet
      vestibulum.

      Aenean egestas magna ante, a auctor purus dignissim ut. Integer ultrices egestas purus eget interdum. Curabitur nec
      augue dolor. Fusce lobortis ex sed lectus vulputate, at dapibus turpis commodo. Sed in eleifend mauris, sit amet
      mattis massa. Suspendisse vel eros quis massa sollicitudin facilisis. Aliquam purus mi, interdum eget elit sed,
      placerat tempor tellus. Maecenas lectus velit, dignissim quis vehicula id, finibus vel eros. Curabitur facilisis est
      neque, id consequat dui hendrerit placerat. Nullam quis vehicula felis. Nunc ex elit, ultrices.

      Sed efficitur nisi nulla, sed blandit velit accumsan a. Phasellus tempus et elit at vehicula. Aenean efficitur
      tempor nulla at imperdiet. Aliquam in libero dignissim, maximus dui ac, aliquam felis. Proin leo sapien, efficitur
      non lacus ut, blandit auctor lacus. Morbi vel pellentesque ex, ac mattis augue. Suspendisse dignissim mauris mauris,
      vel scelerisque nibh volutpat sit amet. Suspendisse risus velit, volutpat quis viverra ut, ultricies vel lectus.
      Quisque lacinia metus ut convallis tincidunt. Donec lobortis felis libero, nec rutrum neque accumsan eget. Phasellus
      velit nunc, rhoncus sit amet libero et, bibendum tempor lectus. In congue magna vel dui vulputate, quis accumsan
      tortor egestas. Vestibulum egestas dignissim tellus, fermentum vulputate dui varius vitae. Nullam suscipit augue vel
      augue mattis, sit amet dictum ante blandit. Donec fringilla dapibus aliquet. Nunc eget erat at augue laoreet
      vestibulum.

      Aenean egestas magna ante, a auctor purus dignissim ut. Integer ultrices egestas purus eget interdum. Curabitur nec
      augue dolor. Fusce lobortis ex sed lectus vulputate, at dapibus turpis commodo. Sed in eleifend mauris, sit amet
      mattis massa. Suspendisse vel eros quis massa sollicitudin facilisis. Aliquam purus mi, interdum eget elit sed,
      placerat tempor tellus. Maecenas lectus velit, dignissim quis vehicula id, finibus vel eros. Curabitur facilisis est
      neque, id consequat dui hendrerit placerat. Nullam quis vehicula felis. Nunc ex elit, ultrices.

      Aenean egestas magna ante, a auctor purus dignissim ut. Integer ultrices egestas purus eget interdum. Curabitur nec
      augue dolor. Fusce lobortis ex sed lectus vulputate, at dapibus turpis commodo. Sed in eleifend mauris, sit amet
      mattis massa. Suspendisse vel eros quis massa sollicitudin facilisis. Aliquam purus mi, interdum eget elit sed,
      placerat tempor tellus. Maecenas lectus velit, dignissim quis vehicula id, finibus vel eros. Curabitur facilisis est
      neque, id consequat dui hendrerit placerat. Nullam quis vehicula felis. Nunc ex elit, ultrices.
    </p>
    <p>IK Image component</p>
    <IKImage :urlEndpoint="urlEndpoint" :path="path" :transformation="[{ height: 200, width: 200 }, { rotation: 360 }]"
      :lqip="{ active: true, threshold: 20, quality: 20, blur: 30 }" loading="lazy" />

    <p>Lazy loading</p>
    <!-- tr:h-200,w-200/default-image.jpg -->
    <IKImage :urlEndpoint="urlEndpoint" :path="path" :transformation="[{ height: 200, width: 200 }]" loading="lazy"
      class="lazyload" />

    <p>Lazyload with LQIP</p>
    <!-- tr:h-200,w-200:q-20,bl-30/default-image.jpg -->
    <IKImage :urlEndpoint="urlEndpoint" :path="path" :transformation="[{ height: 200, width: 200 }]"
      :lqip="{ active: true, threshold: 20, quality: 20, blur: 30 }" loading="lazy" class="lazyload-lqip" />

    <p>With LQIP</p>
    <!-- tr:h-200,w-200:q-20,bl-30/default-image.jpg -->
    <IKImage :urlEndpoint="urlEndpoint" :path="path" :transformation="[{ height: 200, width: 200 }]"
      :lqip="{ active: true, threshold: 20, quality: 20, blur: 30 }" class="lqip" />


    <p>IK Image with context</p>
    <IKContext :publicKey="publicKey" :urlEndpoint="urlEndpoint">
      <template v-slot:default>
        <IKImage :path="path" :transformation='[{ height: 300, width: 400 }]' />
      </template>
    </IKContext>

    <p>Using exported component</p>
    <IKVideo class="ikvideo-default" :urlEndpoint="urlEndpoint" :src="'https://ik.imagekit.io/demo/sample-video.mp4'"
      :transformation="[{ height: 200, width: 200 }]" />

    <p>Video with some advance transformation</p>
    <IKVideo class="ikvideo-with-tr" :urlEndpoint="urlEndpoint" :src="'https://ik.imagekit.io/demo/sample-video.mp4'"
      :transformation="[{ height: 200, width: 600, b: '5_red', q: 95 }]" />

    <p>File upload</p>
    <IKContext :publicKey="publicKey" :urlEndpoint="urlEndpoint" :authenticator="authenticator">
      <IKUpload ref="childComponentRef" :tags="['tag1', 'tag2']" class="file-upload-ik"
        :responseFields="['tags']" :onError="onError" :onSuccess="onSuccess" :onUploadStart="onUploadStart" :onUploadProgress="onUploadProgress"
        :validateFile="validateFile" customCoordinates="10,10,100,100" />
      <p>Your above uploaded file will appear here </p>
      <IKImage :src="uploadedImageSource" :transformation='[{ height: 200, width: 200 }]' class="uploaded-img-ik"/>
    </IKContext>
    <button @click="abortChildUpload">Abort Child Upload</button>
  </div>
</template>

<script>

import ImageKit, { IKImage, IKUpload, IKContext, IKVideo, } from 'imagekitio-vue'
import { createApp } from 'vue';

const app = createApp({});

app.use(ImageKit, {
  urlEndpoint: process.env.VUE_APP_URL_ENDPOINT,
  publicKey: process.env.VUE_APP_PUBLIC_KEY,
})

let path = "/default-image.jpg";

export default {
  name: 'App',
  components: {
    IKImage,
    IKContext,
    IKVideo,
    IKUpload,
  },
  data() {
    return {
      urlEndpoint: process.env.VUE_APP_URL_ENDPOINT,
      publicKey: process.env.VUE_APP_PUBLIC_KEY,
      path,
      src: `${process.env.VUE_APP_URL_ENDPOINT}/${path}`,
      uploadedImageSource: ''
    };
  },
  methods: {
    onError(err) {
      try {
        console.log("Error");
        console.log(err);
      } catch (e) {
        console.error(e);
      }
    },
    onSuccess(res) {
      try {
        console.log("Success");
        console.log(res);
        this.uploadedImageSource = res.url
      } catch (e) {
        console.error(e);
      }
    },
    validateFile(res) {
      if (res.size > 0) {
        return true;
      }
      return false;
    },
    onUploadStart(event) {
      console.log("Upload started");
      console.log(event);
    },
    onUploadProgress(event) {
      console.log(`Upload inprogress ... (${(event.loaded*100/event.total).toFixed(2)}% Done)`)
      console.log(event)
    },
    abortChildUpload() {
      this.$refs.childComponentRef.triggerAbortUpload();
      console.log("Upload aborted")
    },
    authenticator(){
      return new Promise((resolve, reject) => {
        var url = process.env.VUE_APP_AUTHENTICATION_ENDPOINT;

        // Make the Fetch API request
        fetch(url, { method: "GET", mode: "cors" }) // Enable CORS mode
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then((body) => {
            var obj = {
              signature: body.signature,
              expire: body.expire,
              token: body.token,
            };
            resolve(obj);
          })
          .catch((error) => {
            reject([error]);
          });
      });
    }
  }
};
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}

.sample-app {
  font-family: "Avenir", Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  margin-top: 60px;
}

img {
  min-height: 400px;
}
</style>
